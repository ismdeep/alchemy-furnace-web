<br>
<div style="width: 2rem;height: 2rem;position: fixed;bottom: 0;right: 0;z-index: 0;">
  <i nz-icon class="text-blue-light point" nzType="plus-circle" nzTheme="outline" (click)="create()"></i>
</div>

<div class="masonry">
  <div class="item" *ngFor="let task of tasks">
    <nz-card [nzTitle]="task.name" [nzExtra]="tpl">
      <ng-template #tpl>
        <span class="mr-lg" *ngIf="task.last_run" [nz-popover]="formatTime(task.last_run.end_time)">
          <nz-tag nzNoAnimation *ngIf="task.last_run.status == 0" [nzColor]="'yellow'">
            Pending
          </nz-tag>
          <nz-tag nzNoAnimation *ngIf="task.last_run.status == 1" [nzColor]="'yellow'">
            Running
          </nz-tag>
          <nz-tag nzNoAnimation *ngIf="task.last_run.status == 2 && task.last_run.exit_code == 0" [nzColor]="'green'">
            Success
          </nz-tag>
          <nz-tag nzNoAnimation *ngIf="task.last_run.status == 2 && task.last_run.exit_code != 0" [nzColor]="'red'">
            Failed
          </nz-tag>
          <nz-tag nzNoAnimation *ngIf="task.last_run.status == 3" [nzColor]="'gray'">
            Abort
          </nz-tag>
        </span>
        <a class="mr-sm" (click)="addTrigger(task)">+ Trigger</a>
        <i nz-icon class="text-blue-light point ml-md"
           nzType="edit"
           nzTheme="outline"
           (click)="editTask(task)"></i>
        <i nz-icon class="text-blue-light point ml-md"
           nzType="delete"
           nzTheme="outline"
           nz-popconfirm="Are you sure to delete?"
           (nzOnConfirm)="deleteTask(task)"></i>
      </ng-template>
      <div nz-row [nzGutter]="8">
        <div nz-col [nzSpan]="12" *ngFor="let trigger of task.triggers">
          <nz-card [nzTitle]="trigger.name" [nzExtra]="triggerTpl">
            <ng-template #triggerTpl>
              <i nz-icon class="text-blue-light point ml-md"
                 nzType="right"
                 nzTheme="outline"
                 [nz-popconfirm]="'Are you sure to run?'"
                 (nzOnConfirm)="runTrigger(task, trigger)"></i>
              <i nz-icon class="text-blue-light point ml-md"
                 nzType="edit"
                 nzTheme="outline"
                 (click)="editTrigger(task, trigger)"></i>
              <i nz-icon class="text-blue-light point ml-md"
                 nzType="delete"
                 nzTheme="outline"
                 [nz-popconfirm]="'Are you sure to delete?'"
                 (nzOnConfirm)="deleteTrigger(task, trigger)"></i>
            </ng-template>
            <span class="mr-lg" *ngIf="trigger.last_run" [nz-popover]="formatTime(trigger.last_run.end_time)">
              <nz-tag nzNoAnimation *ngIf="trigger.last_run.status == 0" [nzColor]="'yellow'">
                Pending
              </nz-tag>
              <nz-tag nzNoAnimation *ngIf="trigger.last_run.status == 1" [nzColor]="'yellow'">
                Running
              </nz-tag><nz-tag nzNoAnimation *ngIf="trigger.last_run.status == 2 && trigger.last_run.exit_code == 0" [nzColor]="'green'">
              Success
            </nz-tag>
              <nz-tag nzNoAnimation *ngIf="trigger.last_run.status == 2 && trigger.last_run.exit_code != 0" [nzColor]="'red'">
                Failed
              </nz-tag>
              <nz-tag nzNoAnimation *ngIf="trigger.last_run.status == 3" [nzColor]="'gray'">
                Abort
              </nz-tag>
            </span>
            <span class="mr-lg" *ngIf="!trigger.last_run">
              <nz-tag nzNoAnimation [nzColor]="'gray'">No record</nz-tag>
            </span>
            <p *ngIf="trigger.cron != ''">Cron: {{trigger.cron}}</p>
            <pre *ngIf="trigger.environment != ''">{{trigger.environment}}</pre>
          </nz-card>
        </div>
      </div>
      <task-detail TaskID="{{task.id}}"></task-detail>
    </nz-card>
  </div>
</div>
